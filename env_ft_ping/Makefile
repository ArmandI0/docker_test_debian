CONTAINER_NAME=tskmaster-debian
IMAGE_NAME=tskmaster-debian
COMPOSE_FILE=docker-compose.yml

build:
	docker-compose -f $(COMPOSE_FILE) build

up:
	docker-compose -f $(COMPOSE_FILE) run --rm app zsh

down:
	docker-compose -f $(COMPOSE_FILE) down

rm:
	@echo "Suppression des conteneurs Docker Compose..."
	docker-compose -f $(COMPOSE_FILE) down --rmi local -v --remove-orphans

clean:
	@echo "ğŸ§¹ Suppression des conteneurs associÃ©s..."
	docker-compose -f $(COMPOSE_FILE) down --remove-orphans

	@echo "ğŸ§¼ Suppression de l'image Docker..."
	@if docker image inspect $(IMAGE_NAME) > /dev/null 2>&1; then \
		docker rmi -f $(IMAGE_NAME); \
	else \
		echo "Aucune image Ã  supprimer."; \
	fi

	@echo "ğŸ—‘ï¸ Suppression des fichiers temporaires..."
	-rm -rf __pycache__ *.pyc *.pyo *.log

	@echo "âœ… Nettoyage terminÃ©."

prune:
	@echo "ğŸ”¥ Suppression des images anonymes (<none>)..."
	docker image prune -f

	@echo "ğŸ§½ Suppression des volumes non utilisÃ©s..."
	docker volume prune -f

	@echo "ğŸ§¼ Suppression du cache Docker (dangling builds)..."
	docker builder prune -f

	@echo "âœ… Docker nettoyÃ©."

restart: down up